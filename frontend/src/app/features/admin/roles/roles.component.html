<p-toast></p-toast>
<p-confirmDialog></p-confirmDialog>
<br />
<div class="flex justify-between items-center mb-4">
  <h2 class="text-xl font-semibold">Roles</h2>
  <button
    pButton
    label="Nuevo rol"
    icon="pi pi-plus"
    (click)="openCreate()"
  ></button>
</div>

<p-table [value]="roles" [loading]="loading" dataKey="roleName" class="w-full">
  <ng-template pTemplate="header">
    <tr>
      <th>Rol</th>
      <th class="text-right">Acciones</th>
    </tr>
  </ng-template>

  <ng-template pTemplate="body" let-r>
    <tr>
      <td>{{ r.roleName }}</td>
      <td class="text-right">
        <p-button
          icon="pi pi-shield"
          label="Permisos"
          class="mr-2"
          (click)="openPerms(r)"
        ></p-button>

        <p-button
          icon="pi pi-trash"
          severity="danger"
          (click)="confirmDelete(r)"
        ></p-button>
      </td>
    </tr>
  </ng-template>
</p-table>

<p-dialog
  [(visible)]="showCreate"
  header="Crear rol"
  [modal]="true"
  [style]="{ width: '520px' }"
>
  <div class="flex flex-col gap-3">
    <div>
      <label class="block mb-1 text-sm">Nombre del rol</label>
      <input
        pInputText
        [(ngModel)]="newRoleName"
        class="w-full border border-gray-300 dark:border-gray-700 bg-white dark:bg-gray-800 rounded-md px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500/30 focus:border-blue-500"
      />
    </div>
    <div class="flex justify-end gap-2">
      <button
        pButton
        type="button"
        label="Cancelar"
        severity="secondary"
        (click)="showCreate = false"
      ></button>
      <button
        pButton
        type="button"
        label="Crear"
        (click)="createRole()"
        [disabled]="!newRoleName.trim()"
      ></button>
    </div>
  </div>
</p-dialog>

<p-dialog
  [(visible)]="showPerms"
  [modal]="true"
  [style]="{ width: '720px', maxWidth: '95vw' }"
  [header]="selectedRole ? 'Permisos Â· ' + selectedRole.roleName : 'Permisos'"
>
  <div class="flex flex-col gap-3">
    <div>
      <label class="block mb-1 text-sm">Permisos</label>

      <p-multiSelect
        [options]="allPermissions"
        [(ngModel)]="selectedPermissions"
        defaultLabel="Selecciona permisos"
        [display]="'chip'"
        [filter]="true"
        appendTo="body"
        [panelStyle]="{ maxHeight: '260px' }"
      >
        <ng-template let-p pTemplate="item">{{ p }}</ng-template>
        <ng-template let-p pTemplate="selectedItem">{{ p }}</ng-template>
      </p-multiSelect>
    </div>

    <div class="flex justify-end gap-2 pt-2">
      <button
        pButton
        type="button"
        label="Cancelar"
        severity="secondary"
        (click)="showPerms = false"
      ></button>
      <button
        pButton
        type="button"
        label="Guardar"
        (click)="savePerms()"
      ></button>
    </div>
  </div>
</p-dialog>
